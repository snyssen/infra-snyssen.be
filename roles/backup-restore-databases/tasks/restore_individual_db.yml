- name: "Querying available dumps for {{ db_restore_selected_individual.key }}"
  ansible.builtin.find:
    path: "{{ db_restore_selected_individual.value.directory }}"
    file_type: file
    recurse: yes
  register: available_dump_files

- ansible.builtin.pause:
    prompt: |-

      {% for path in available_dump_files.files | map(attribute='path') | map('regex_replace', '^' + db_restore_selected_individual.value.directory + '/', '') | sort %}
        - {{ path }}
      {% endfor %}

      -> Please select a dump in the list above for restoring the {{ db_restore_selected_individual.key }} database
  register: db_selected_restore

- ansible.builtin.assert:
    that:
      - "db_restore_selected_individual.value.directory + '/' + db_selected_restore.user_input in available_dump_files.files | map(attribute='path')"
    fail_msg: "'{{ db_selected_restore.user_input }}' is not one of the available dumps."

- name: "restoring {{ db_restore_selected_individual.value.type }} dump '{{ db_selected_restore.user_input }}' for {{ db_restore_selected_individual.key }} database"
  ansible.builtin.include_tasks: "{{ db_restore_selected_individual.value.type }}_restore.yml"
