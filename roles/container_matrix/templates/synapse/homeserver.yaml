# Configuration file for Synapse.
#
# This is a YAML file: see [1] for a quick introduction. Note in particular
# that *indentation is important*: all the elements of a list or dictionary
# should have the same indentation.
#
# [1] https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html
#
# For more information on how to configure Synapse, including a complete accounting of
# each option, go to docs/usage/configuration/config_documentation.md or
# https://element-hq.github.io/synapse/latest/usage/configuration/config_documentation.html
server_name: "matrix.{{ ansible_fqdn }}"
pid_file: /data/homeserver.pid
listeners:
  - port: 8008
    tls: false
    type: http
    x_forwarded: true
    resources:
      - names: [client, federation]
        compress: false
database:
  name: psycopg2
  args:
    user: matrix
    password: "{{ matrix__db_pass }}"
    dbname: matrix
    host: postgres
    cp_min: 5
    cp_max: 10
matrix_authentication_service:
  enabled: true
  endpoint: https://matrix-mas.{{ ansible_fqdn }}/
  secret: "{{ matrix__mas__shared_secret }}"
log_config: "/data/log.config"
media_store_path: /data/media_store
registration_shared_secret: "{{ matrix__registration_shared_secret }}"
report_stats: true
serve_server_wellknown: true
macaroon_secret_key: "{{ matrix__macaroon_secret_key }}"
form_secret: "{{ matrix__form_secret }}"
signing_key_path: "/data/signing.key"
trusted_key_servers:
  - server_name: "matrix.org"
ip_range_whitelist:
{% for ip in internal_networks_cidr %}
  - "{{ ip }}"
{% endfor %}
url_preview_enabled: true
url_preview_ip_range_blacklist:
- 127.0.0.0/8
- 10.0.0.0/8
- 172.16.0.0/12
- 192.168.0.0/16
- 100.64.0.0/10
- 192.0.0.0/24
- 169.254.0.0/16
- 192.88.99.0/24
- 198.18.0.0/15
- 192.0.2.0/24
- 198.51.100.0/24
- 203.0.113.0/24
- 224.0.0.0/4
- ::1/128
- fe80::/10
- fc00::/7
- 2001:db8::/32
- ff00::/8
- fec0::/10
url_preview_ip_range_whitelist:
- 192.168.1.10
app_service_config_files:
  - /data/app_services/doublepuppet.yaml
  - /data/app_services/matrix_discord.yaml
  - /data/app_services/matrix_signal.yaml
  - /data/app_services/matrix_whatsapp.yaml
  - /data/app_services/matrix_meta.yaml
experimental_features:
  msc3202_device_masquerading: true
