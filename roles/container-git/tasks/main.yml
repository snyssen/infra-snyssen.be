- name: Creating folders
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
  with_items:
    # postgres
    - "{{ docker_mounts_directory }}/git/postgresql"
    - /mnt/storage/backups/gitea
    # gitea
    - /mnt/storage/gitea

- ansible.builtin.include_role:
    name: container-deploy
  vars:
    container_name: git

- name: Wait for gitea to startup before ensuing commands
  ansible.builtin.pause:
    seconds: 15

- name: Creating user account
  community.docker.docker_container_exec:
    container: gitea
    command: "gitea admin user create --username {{ git__gitea__admin_username }} --password {{ git__gitea__admin_password }} --email {{ git__gitea__admin_email }} --admin"
    user: git
  register: gitea_user_creation
  changed_when: "'successfully created' in gitea_user_creation.stdout"
  failed_when:
    - gitea_user_creation.rc > 0
    - "'user already exists' not in gitea_user_creation.stdout"
