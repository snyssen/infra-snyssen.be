- ansible.builtin.assert:
    that:
      - "restic_server == 'local' or restic_server == 'remote'"
    fail_msg: "`restic_server` must be set to either 'local' or 'remote'. Current value is '{{ restic_server }}'"

- name: "Querying restic snapshots on {{ restic_server }}"
  community.docker.docker_container_exec:
    container: "{{ 'restic_remote' if restic_server == 'remote' else 'restic_local' }}"
    command: restic snapshots
  register: restic_available_snapshots

- ansible.builtin.pause:
    prompt: |
      
      {{ restic_available_snapshots.stdout }}
      
      -> Please enter the desired snapshot ID to restore from the list above.
  register: restic_selected_snapshot

# - ansible.builtin.pause:
#     prompt: -> Please specify the path you would like to restore. Press 'ctrl + C' then 'C' again to restore everything
#   register: restic_selected_restore_path

- name: Restoring files
  community.docker.docker_container_exec:
    container: "{{ 'restic_remote' if restic_server == 'remote' else 'restic_local' }}"
    command: "restic restore {{ restic_selected_snapshot.user_input }} --target /"
