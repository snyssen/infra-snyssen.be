- name: Creating folders
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
  with_items:
    - /mnt/storage/firefly
    - "{{ docker_mounts_directory }}/firefly/postgresql"
    - /mnt/storage/backups/firefly

- name: Deploying hooks for database backups
  ansible.builtin.copy:
    src: pgsql_backups_hooks
    dest: "{{ docker_compose_directory }}/firefly/hooks/"
    mode: 0770

- ansible.builtin.include_role:
    name: snyssen.compose_deploy
  vars:
    container_name: "firefly"

- name: Add cron job for firefly
  ansible.builtin.cron:
    name: firefly
    minute: "0"
    hour: "*/6"
    job: >-
      docker exec firefly /usr/local/bin/php /var/www/html/artisan firefly-iii:cron
      && curl -fsS -m 10 --retry 5 -o /dev/null https://hc-ping.com/{{ firefly__cron_healthcheck_id }}
