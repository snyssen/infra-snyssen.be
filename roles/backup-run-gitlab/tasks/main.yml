- name: Backing up GitLab to disk
  community.docker.docker_container_exec:
    container: gitlab
    command: gitlab-backup create

- name: Making backups of gitlab.rb and gitlab-secrets.json
  become: yes
  ansible.builtin.copy:
    src: "{{ item }}"
    remote_src: yes
    dest: /mnt/storage/backups/gitlab/
  with_items:
    - "{{ docker_mounts_directory }}/gitlab/config/gitlab.rb"
    - "{{ docker_mounts_directory }}/gitlab/config/gitlab-secrets.json"