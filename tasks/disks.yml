- name: Creating mounting directories
  become: yes
  ansible.builtin.file:
    path: "{{ item.path  }}"
    state: directory
  with_items: "{{ disks_mounts }}"
- name: Mounting disks
  become: yes
  ansible.builtin.mount:
    path: "{{ item.path }}"
    src: "{{ item.src }}"
    fstype: auto
    opts: defaults
    state: present
  with_items: "{{ disks_mounts }}"
- name: Creating storage mount
  become: yes
  ansible.builtin.file:
    path: /mnt/storage
    state: directory
- name: Mounting storage volume w/ MergerFS
  become: yes
  ansible.builtin.mount:
    path: /mnt/storage
    src: /mnt/disk*
    fstype: fuse.mergerfs
    opts: defaults,nonempty,allow_other,use_ino,cache.files=off,moveonenospc=true,category.create=mfs,minfreespace=20G,fsname=mergerfs-storage
    state: present
- name: Deploying SnapRAID configuration
  become: yes
  ansible.builtin.template:
    src: configs/snapraid/snapraid.conf.j2
    dest: /etc/snapraid.conf
    owner: root
    group: root
    mode: '0644'